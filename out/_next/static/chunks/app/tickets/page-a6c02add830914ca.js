(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[988],{8086:function(e,t,a){Promise.resolve().then(a.bind(a,2707))},8513:function(e,t,a){"use strict";a.d(t,{Ak:function(){return findAllUsers},FG:function(){return findAllSites},M4:function(){return deleteTicket},O:function(){return updateTicket},Qn:function(){return getTicketById},a2:function(){return findAllTickets},ax:function(){return createTicket}});var s=a(2173),n=a(2601);let i="".concat(n.env.NEXT_PUBLIC_BACKEND,"/record"),c="".concat(n.env.NEXT_PUBLIC_BACKEND,"/user"),r="".concat(n.env.NEXT_PUBLIC_BACKEND,"/site"),findAllTickets=async()=>{let e=await s.Z.get("".concat(i,"/all"));return e.data},findAllUsers=async()=>{let e=await s.Z.get("".concat(c,"/all"));return e.data},createTicket=async()=>{let e=await s.Z.post("".concat(i,"/addticket"));return e.data},deleteTicket=async e=>{let t=await s.Z.delete("".concat(i,"/delete/").concat(e));return t.data},findAllSites=async()=>{let e=await s.Z.get("".concat(r,"/all"));return e.data},updateTicket=async(e,t)=>{try{let a=await s.Z.put("".concat(i,"/updateticket/").concat(e),t);return a.data}catch(e){throw console.error("Error updating ticket:",e),e}},getTicketById=async e=>{try{let t=await s.Z.get("".concat(i,"/ticket/").concat(e));return t.data}catch(e){throw console.error("Error fetching ticket:",e),e}}},2707:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Tickets}});var s=a(7437);a(4063);var n=a(2265),i=a(7431),c=a(1678),r=a(8920),l=a(7846),o=a(2058),d=a(3198),u=a(4033),m=a(2173),h=a(2601);let g="".concat(h.env.NEXT_PUBLIC_BACKEND,"/record"),findTotalTickets=async()=>{let e=await m.Z.get("".concat(g,"/totalcount"));return e.data},findTotalComplete=async()=>{let e=await m.Z.get("".concat(g,"/totalComplete"));return e.data},findTotalLoading=async()=>{let e=await m.Z.get("".concat(g,"/totalLoading"));return e.data};var x=a(7681);function UserInfo(){let e=new Date().toISOString().split("T")[0],[t,a]=(0,n.useState)(0),[m,h]=(0,n.useState)(0),[g,p]=(0,n.useState)(0),[j,N]=(0,n.useState)("Fetching userLocation..."),[f,b]=(0,n.useState)(!1),[v,k]=(0,n.useState)(""),T=(0,d.v9)(e=>e.auth.user),y=(0,d.I0)(),w=(0,u.useRouter)(),fetchTotalTicketCount=async()=>{let e=await findTotalTickets();a(e.count)},fetchTotalCompleteCount=async()=>{let e=await findTotalComplete();h(e.count)},fetchTotalLoadingCount=async()=>{let e=await findTotalLoading();p(e.count)},getuserLocation=()=>{navigator.geouserLocation?navigator.geouserLocation.getCurrentPosition(showPosition,showError):N("GeouserLocation is not supported by this browser.")},showPosition=e=>{let t=e.coords.latitude,a=e.coords.longitude;N("Latitude: ".concat(t,", Longitude: ").concat(a))},showError=e=>{switch(e.code){case e.PERMISSION_DENIED:N("User denied the request for GeouserLocation.");break;case e.POSITION_UNAVAILABLE:N("userLocation information is unavailable.");break;case e.TIMEOUT:N("The request to get user userLocation timed out.");break;default:N("An unknown error occurred.")}};return(0,n.useEffect)(()=>{fetchTotalTicketCount(),fetchTotalCompleteCount(),fetchTotalLoadingCount(),getuserLocation()},[]),(0,s.jsxs)("div",{className:"user-container",children:[T&&(0,s.jsxs)("h5",{children:["Welcome, ",T.firstName," ",T.lastName," (",T.role,")"]}),(0,s.jsx)("button",{onClick:()=>{y((0,x.TX)()).then(()=>{w.push("/login")}).catch(e=>{console.error("Logout failed:",e)})},className:"btn btn-danger buttom-align mb-3",children:"Sign Out"}),(0,s.jsx)("hr",{}),(0,s.jsxs)("div",{className:"container text-left",children:[(0,s.jsxs)("div",{className:"row row-format ",children:[(0,s.jsxs)("div",{className:"col",children:[(0,s.jsx)(c.IPN,{className:"info-icon"})," Date: ",(0,s.jsx)("br",{})," ",e]}),(0,s.jsxs)("div",{className:"col",children:[(0,s.jsx)(i.Kaj,{className:"info-icon"})," Total Tickets: ",(0,s.jsx)("br",{})," ",t]})]}),(0,s.jsxs)("div",{className:"row row-format ",children:[(0,s.jsxs)("div",{className:"col",children:[(0,s.jsx)(l.DqJ,{className:"info-icon"})," Complete Tickets: ",(0,s.jsx)("br",{})," ",m]}),(0,s.jsxs)("div",{className:"col",children:[(0,s.jsx)(r.dAq,{className:"info-icon"})," Loading Tickets: ",(0,s.jsx)("br",{})," ",g]})]}),(0,s.jsx)("div",{className:"row row-format ",children:(0,s.jsxs)("div",{className:"col",children:[(0,s.jsx)(o.hKA,{className:"info-icon"})," Current userLocation: ",(0,s.jsx)("br",{})," ",j]})}),(0,s.jsx)("div",{className:"row row-format ",children:(0,s.jsx)("div",{className:"col",children:(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("label",{htmlFor:"reminder",className:"form-label",children:"Reminder:"}),(0,s.jsx)("input",{type:"text",className:"form-control",id:"reminder",value:v,onChange:e=>{k(e.target.value)},disabled:!f})]})})}),(0,s.jsx)("hr",{}),(0,s.jsxs)("div",{className:"d-grid gap-2 d-md-flex justify-content-md-end",children:[(0,s.jsx)("button",{className:"btn btn-primary me-md-2 tickets-button",type:"button",onClick:()=>{b(!0)},children:"Update"}),(0,s.jsx)("button",{className:"btn btn-success tickets-button",type:"button",onClick:()=>{b(!1)},children:"Save"})]})]})]})}a(8537);var p=a(1396),j=a.n(p),N=a(8513),f=a(4606);function Tickets(){let e=(0,u.useRouter)(),t=(0,d.v9)(e=>e.auth.user),[a,i]=(0,n.useState)([]),[c,r]=(0,n.useState)({MonitoringLocationIdentifier:"",MonitoringYear:"",MonitoringWeek:"",MonitoringLocationDescriptionText:"",EstimatedDate:"",IndicatorsName:"",status:""}),[l,m]=(0,n.useState)([]),[h,g]=(0,n.useState)(1),[x,p]=(0,n.useState)(""),[b,v]=(0,n.useState)(""),k=Math.ceil(a.length/6),[T,y]=(0,n.useState)(1),w=Math.ceil(l.length/3),paginateUsers=e=>y(e),C=6*h,L=C-6,E=a.slice(L,C),paginate=e=>g(e),S=3*T,_=S-3,U=l.slice(_,S),handleAddTicket=async()=>{try{let t=await N.ax(c);t&&t._id&&(e.push("/tickets/ticketDetail?_id=".concat(t._id)),i([t,...a]))}catch(e){console.error("Error creating ticket:",e)}},deleteTicket=async e=>{try{await N.M4(e._id);let t=a.filter(t=>t._id!==e._id);i(t)}catch(e){console.log(e)}},loadTickets=async()=>{try{let e=await N.a2();i(e)}catch(e){console.error("Error loading tickets:",e)}},loadUsers=async()=>{try{let e=await N.Ak();m(e)}catch(e){console.error("Error loading users:",e)}};return(0,n.useEffect)(()=>{t?(loadTickets(),loadUsers()):e.push("/login")},[t,e]),(0,s.jsx)("div",{className:"home p-0",children:t&&(0,s.jsx)("div",{className:"container",children:(0,s.jsxs)("div",{className:"row",children:[(0,s.jsxs)("div",{className:"col-12 tickets-top-nav ",children:[(0,s.jsxs)("div",{className:"col-12 d-flex justify-content-between",children:[(0,s.jsx)("nav",{"aria-label":"breadcrumb",children:(0,s.jsxs)("ol",{className:"breadcrumb",children:[(0,s.jsx)("li",{className:"breadcrumb-item",children:(0,s.jsx)(j(),{href:"/tickets",children:"Ticket"})}),(0,s.jsx)("li",{className:"breadcrumb-item active","aria-current":"page",children:"Home"})]})}),(0,s.jsxs)("button",{className:"btn btn-primary btn-sm",type:"button",onClick:handleAddTicket,children:["+ ",(0,s.jsx)(o.xNM,{})," New Ticket !"]})]}),(0,s.jsx)("hr",{})]}),(0,s.jsx)("div",{className:"col-8",children:(0,s.jsx)(UserInfo,{})}),(0,s.jsxs)("div",{className:"list-group col-4 mb-5",children:[(0,s.jsx)("h5",{children:"Connections: "}),U.map(e=>(0,s.jsxs)(j(),{href:"/guest?username=".concat(e.username),className:"list-group-item list-group-item-action",children:[(0,s.jsxs)("div",{className:"d-flex w-100 justify-content-between",children:[(0,s.jsxs)("h6",{className:"mb-1",children:[e.firstName," ",e.lastName]}),(0,s.jsx)("small",{className:"text-body-secondary",children:e.company})]}),(0,s.jsx)("small",{className:"text-body-secondary",children:e.email})]},e._id)),(0,s.jsx)("br",{}),(0,s.jsx)("nav",{"aria-label":"User page navigation",children:(0,s.jsx)("ul",{className:"pagination",children:(()=>{let e=[];if(w<=10)for(let t=1;t<=w;t++)e.push((0,s.jsx)("li",{className:"page-item ".concat(t===T?"active":""),children:(0,s.jsx)("a",{className:"page-link",href:"#",onClick:()=>paginateUsers(t),children:t})},t));else{for(let t=1;t<=6;t++)e.push((0,s.jsx)("li",{className:"page-item ".concat(t===T?"active":""),children:(0,s.jsx)("a",{className:"page-link",href:"#",onClick:()=>paginateUsers(t),children:t})},t));e.push((0,s.jsx)("li",{className:"page-item disabled",children:(0,s.jsx)("span",{className:"page-link",children:"..."})},"ellipsis"));for(let t=w-3;t<=w;t++)e.push((0,s.jsx)("li",{className:"page-item ".concat(t===T?"active":""),children:(0,s.jsx)("a",{className:"page-link",href:"#",onClick:()=>paginateUsers(t),children:t})},t))}return e})()})}),(0,s.jsxs)("form",{className:"row g-3",onSubmit:e=>{e.preventDefault();let t=Number(b);t>=1&&t<=w&&(y(t),v(""))},children:[(0,s.jsx)("div",{className:"col-auto",children:(0,s.jsx)("h5",{children:"Go to Page:"})}),(0,s.jsx)("div",{className:"col-auto",children:(0,s.jsx)("input",{className:"form-control",type:"number",value:b,onChange:e=>{v(e.target.value)}})}),(0,s.jsx)("div",{className:"col-auto",children:(0,s.jsx)("button",{className:"btn btn-primary gap-1 buttom-align mb-3",type:"submit",children:"Go"})})]})]}),(0,s.jsx)("br",{}),(0,s.jsxs)("div",{className:"list-group col-12",children:[(0,s.jsx)("br",{}),(0,s.jsx)("h5",{children:"Tickets: "}),(0,s.jsxs)("nav",{"aria-label":"Page navigation example",children:[(0,s.jsx)("ul",{className:"pagination",children:(()=>{let e=[];if(k<=30)for(let t=1;t<=k;t++)e.push((0,s.jsx)("li",{className:"page-item ".concat(t===h?"active":""),children:(0,s.jsx)("a",{className:"page-link",href:"#",onClick:()=>paginate(t),children:t})},t));else{for(let t=1;t<=15;t++)e.push((0,s.jsx)("li",{className:"page-item ".concat(t===h?"active":""),children:(0,s.jsx)("a",{className:"page-link",href:"#",onClick:()=>paginate(t),children:t})},t));e.push((0,s.jsx)("li",{className:"page-item disabled",children:(0,s.jsx)("span",{className:"page-link",children:"..."})},"ellipsis"));for(let t=k-5;t<=k;t++)e.push((0,s.jsx)("li",{className:"page-item ".concat(t===h?"active":""),children:(0,s.jsx)("a",{className:"page-link",href:"#",onClick:()=>paginate(t),children:t})},t))}return e})()}),(0,s.jsxs)("form",{className:"row g-3",onSubmit:e=>{e.preventDefault();let t=Number(x);t>=1&&t<=k&&(g(t),p(""))},children:[(0,s.jsx)("div",{className:"col-auto",children:(0,s.jsx)("h5",{children:"Go to Page:"})}),(0,s.jsx)("div",{className:"col-auto",children:(0,s.jsx)("input",{className:"form-control",type:"number",value:x,onChange:e=>{p(e.target.value)}})}),(0,s.jsx)("div",{className:"col-auto",children:(0,s.jsx)("button",{className:"btn btn-primary gap-1 buttom-align mb-3",type:"submit",children:"Go"})})]})]}),E.map((e,t)=>(0,s.jsxs)(j(),{href:"/tickets/ticketDetail?_id=".concat(e._id),className:"list-group-item list-group-item-action",children:[(0,s.jsxs)("div",{className:"d-flex w-100 justify-content-between",children:[(0,s.jsxs)("h6",{className:"mb-1",children:["Location: ",e.name||e.MonitoringLocationDescriptionText]}),(0,s.jsxs)("small",{className:"text-body-secondary",children:[e._id," ",(0,s.jsx)("br",{}),(0,s.jsx)("button",{className:"btn btn-danger me-2 float-end buttom-align",onClick:t=>{t.preventDefault(),t.stopPropagation(),deleteTicket(e)},children:(0,s.jsx)(f.tgD,{})}),(0,s.jsx)("button",{className:"btn float-end me-2 buttom-align ".concat("complete"===e.status?"btn-success":"btn-warning"),children:"complete"===e.status?"Complete":"Loading"})]})]}),(0,s.jsx)("small",{className:"text-body-secondary",children:e.EstimatedDate})]},t)),(0,s.jsx)("br",{})]})]})})})}},7681:function(e,t,a){"use strict";a.d(t,{TX:function(){return logoutUser},ZP:function(){return auth},pH:function(){return loginUser}});var s=a(2173),n=a(2601);let i=n.env.NEXT_PUBLIC_BACKEND,c="LOGIN_REQUEST",r="LOGIN_SUCCESS",l="LOGIN_FAILURE",requestLogin=()=>({type:c}),receiveLogin=e=>({type:r,user:e}),loginError=e=>({type:l,message:e});function auth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isFetching:!1,isAuthenticated:!1,user:null,errorMessage:""},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case c:return{...e,isFetching:!0,isAuthenticated:!1,user:null,errorMessage:""};case r:return{...e,isFetching:!1,isAuthenticated:!0,user:t.user,errorMessage:""};case l:return{...e,isFetching:!1,isAuthenticated:!1,user:null,errorMessage:t.message};case"LOGOUT_SUCCESS":return{...e,isAuthenticated:!1,user:null};default:return e}}let loginUser=(e,t)=>a=>(a(requestLogin()),s.Z.post("".concat(i,"/auth/login"),{username:e,password:t},{withCredentials:!0}).then(e=>{a(receiveLogin(e.data.user))}).catch(e=>{let t=e.response?e.response.data.message:e.message;a(loginError(t))})),logoutUser=()=>e=>s.Z.get("".concat(i,"/auth/logout"),{},{withCredentials:!0}).then(()=>{e({type:"LOGOUT_SUCCESS"})}).catch(e=>{console.error("Logout error:",e)})},8537:function(){},4063:function(){}},function(e){e.O(0,[447,982,370,724,122,126,198,396,249,971,864,744],function(){return e(e.s=8086)}),_N_E=e.O()}]);